
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>restapi.shapefile &#8212; restapi  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for restapi.shapefile</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">shapefile.py</span>
<span class="sd">Provides read and write support for ESRI Shapefiles.</span>
<span class="sd">author: jlawhead&lt;at&gt;geospatialpython.com</span>
<span class="sd">date: 2015/06/22</span>
<span class="sd">version: 1.2.3</span>
<span class="sd">Compatible with Python versions 2.4-3.x</span>
<span class="sd">version changelog: Reader.iterShapeRecords() bugfix for Python 3</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.2.3&quot;</span>

<span class="kn">from</span> <span class="nn">struct</span> <span class="k">import</span> <span class="n">pack</span><span class="p">,</span> <span class="n">unpack</span><span class="p">,</span> <span class="n">calcsize</span><span class="p">,</span> <span class="n">error</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">array</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="c1">##import codecs</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">range</span>

<span class="kn">import</span> <span class="nn">six</span>


<span class="c1">#</span>
<span class="c1"># Constants for shape types</span>
<span class="n">NULL</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">POINT</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">POLYLINE</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">POLYGON</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">MULTIPOINT</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">POINTZ</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">POLYLINEZ</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">POLYGONZ</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">MULTIPOINTZ</span> <span class="o">=</span> <span class="mi">18</span>
<span class="n">POINTM</span> <span class="o">=</span> <span class="mi">21</span>
<span class="n">POLYLINEM</span> <span class="o">=</span> <span class="mi">23</span>
<span class="n">POLYGONM</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">MULTIPOINTM</span> <span class="o">=</span> <span class="mi">28</span>
<span class="n">MULTIPATCH</span> <span class="o">=</span> <span class="mi">31</span>

<span class="n">PYTHON3</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
<span class="n">DATE_EXP</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\d</span><span class="si">{4}</span><span class="s1">[-/]\d</span><span class="si">{2}</span><span class="s1">[-/]\d</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">PYTHON3</span><span class="p">:</span>
    <span class="n">xrange</span> <span class="o">=</span> <span class="nb">range</span>
    <span class="n">izip</span> <span class="o">=</span> <span class="nb">zip</span>
    <span class="n">six</span><span class="o">.</span><span class="n">string_types</span> <span class="o">=</span> <span class="nb">str</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">izip</span>

<div class="viewcode-block" id="b"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.b">[docs]</a><span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">PYTHON3</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># For python 3 encode str to bytes.</span>
            <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="c1"># Already bytes.</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Error.</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown input type&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For python 2 assume str passed in and return str.</span>
        <span class="k">return</span> <span class="n">v</span></div>

<span class="c1">##def open(filename, mode):</span>
<span class="c1">##    &quot;&quot;&quot;wrapper to use codecs.open&quot;&quot;&quot;</span>
<span class="c1">##    return codecs.open(filename, mode, &#39;utf-8&#39;)</span>

<div class="viewcode-block" id="u"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.u">[docs]</a><span class="k">def</span> <span class="nf">u</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">PYTHON3</span><span class="p">:</span>
        <span class="c1"># try/catch added 2014/05/07</span>
        <span class="c1"># returned error on dbf of shapefile</span>
        <span class="c1"># from www.naturalearthdata.com named</span>
        <span class="c1"># &quot;ne_110m_admin_0_countries&quot;.</span>
        <span class="c1"># Just returning v as is seemed to fix</span>
        <span class="c1"># the problem.  This function could</span>
        <span class="c1"># be condensed further.</span>
        <span class="k">try</span><span class="p">:</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
              <span class="c1"># For python 3 decode bytes to str.</span>
              <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
          <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
              <span class="c1"># Already str.</span>
              <span class="k">return</span> <span class="n">v</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="c1"># Error.</span>
              <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown input type&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="n">v</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For python 2 assume str passed in and return str.</span>
        <span class="k">return</span> <span class="n">v</span></div>

<div class="viewcode-block" id="is_string"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.is_string">[docs]</a><span class="k">def</span> <span class="nf">is_string</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">PYTHON3</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span></div>

<span class="k">class</span> <span class="nc">_Array</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts python tuples to lits of the appropritate type.</span>
<span class="sd">    Used to unpack different shapefile header parts.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

<div class="viewcode-block" id="signed_area"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.signed_area">[docs]</a><span class="k">def</span> <span class="nf">signed_area</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the signed area enclosed by a ring using the linear time</span>
<span class="sd">    algorithm at http://www.cgafaq.info/wiki/Polygon_Area. A value &gt;= 0</span>
<span class="sd">    indicates a counter-clockwise oriented ring.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">))</span>
    <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ys</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)))</span><span class="o">/</span><span class="mf">2.0</span></div>

<span class="k">class</span> <span class="nc">_Shape</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapeType</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stores the geometry of the different shape types</span>
<span class="sd">        specified in the Shapefile spec. Shape types are</span>
<span class="sd">        usually point, polyline, or polygons. Every shape type</span>
<span class="sd">        except the &quot;Null&quot; type contains points at some level for</span>
<span class="sd">        example verticies in a polygon. If a shape type has</span>
<span class="sd">        multiple shapes containing points within a single</span>
<span class="sd">        geometry record then those shapes are called parts. Parts</span>
<span class="sd">        are designated by their starting index in geometry record&#39;s</span>
<span class="sd">        list of shapes.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">=</span> <span class="n">shapeType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">__geo_interface__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">[</span><span class="n">POINT</span><span class="p">,</span> <span class="n">POINTM</span><span class="p">,</span> <span class="n">POINTZ</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span>
            <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MULTIPOINT</span><span class="p">,</span> <span class="n">MULTIPOINTM</span><span class="p">,</span> <span class="n">MULTIPOINTZ</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;MultiPoint&#39;</span><span class="p">,</span>
            <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">])</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">[</span><span class="n">POLYLINE</span><span class="p">,</span> <span class="n">POLYLINEM</span><span class="p">,</span> <span class="n">POLYLINEZ</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;LineString&#39;</span><span class="p">,</span>
                <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">])</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ps</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ps</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ps</span> <span class="o">=</span> <span class="n">part</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">ps</span><span class="p">:</span><span class="n">part</span><span class="p">]]))</span>
                        <span class="n">ps</span> <span class="o">=</span> <span class="n">part</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">part</span><span class="p">:]]))</span>
                <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;MultiLineString&#39;</span><span class="p">,</span>
                <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
                <span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">[</span><span class="n">POLYGON</span><span class="p">,</span> <span class="n">POLYGONM</span><span class="p">,</span> <span class="n">POLYGONZ</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">,</span>
                <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">]),)</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ps</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ps</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ps</span> <span class="o">=</span> <span class="n">part</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">ps</span><span class="p">:</span><span class="n">part</span><span class="p">]]))</span>
                        <span class="n">ps</span> <span class="o">=</span> <span class="n">part</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">part</span><span class="p">:]]))</span>
                <span class="n">polys</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">poly</span> <span class="o">=</span> <span class="p">[</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="n">signed_area</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
                        <span class="n">poly</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">poly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
                <span class="n">polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">{</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">polys</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="p">}</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">polys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">{</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;MultiPolygon&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="n">polys</span>
                    <span class="p">}</span>

<span class="k">class</span> <span class="nc">_ShapeRecord</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A shape object of any type.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">record</span> <span class="o">=</span> <span class="n">record</span>

<div class="viewcode-block" id="ShapefileException"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.ShapefileException">[docs]</a><span class="k">class</span> <span class="nc">ShapefileException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An exception to handle shapefile specific problems.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="Reader"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Reader">[docs]</a><span class="k">class</span> <span class="nc">Reader</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Reads the three files of a shapefile as a unit or</span>
<span class="sd">    separately.  If one of the three files (.shp, .shx,</span>
<span class="sd">    .dbf) is missing no exception is thrown until you try</span>
<span class="sd">    to call a method that depends on that particular file.</span>
<span class="sd">    The .shx index file is used if available for efficiency</span>
<span class="sd">    but is not required to read the geometry from the .shp</span>
<span class="sd">    file. The &quot;shapefile&quot; argument in the constructor is the</span>
<span class="sd">    name of the file you want to open.</span>
<span class="sd">    You can instantiate a Reader without specifying a shapefile</span>
<span class="sd">    and then specify one later with the load() method.</span>
<span class="sd">    Only the shapefile headers are read upon loading. Content</span>
<span class="sd">    within each file is only accessed when required and as</span>
<span class="sd">    efficiently as possible. Shapefiles are usually not large</span>
<span class="sd">    but they can be.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapeName</span> <span class="o">=</span> <span class="s2">&quot;Not specified&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offsets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shpLength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numRecords</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dbfHdrLength</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># See if a shapefile name was passed as an argument</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_string</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">return</span>
        <span class="k">if</span> <span class="s2">&quot;shp&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;shp&quot;</span><span class="p">],</span> <span class="s2">&quot;read&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;shp&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shp</span><span class="p">,</span> <span class="s2">&quot;seek&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">shp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;shx&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;shx&quot;</span><span class="p">],</span> <span class="s2">&quot;read&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">shx</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;shx&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shx</span><span class="p">,</span> <span class="s2">&quot;seek&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">shx</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;dbf&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;dbf&quot;</span><span class="p">],</span> <span class="s2">&quot;read&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;dbf&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="p">,</span> <span class="s2">&quot;seek&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shp</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Shapefile Reader requires a shapefile or file-like object.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Reader.load"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Reader.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapefile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Opens a shapefile from a filename or file-like</span>
<span class="sd">        object. Normally this method would be called by the</span>
<span class="sd">        constructor with the file object or file name as an</span>
<span class="sd">        argument.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">shapefile</span><span class="p">:</span>
            <span class="p">(</span><span class="n">shapeName</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">shapefile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shapeName</span> <span class="o">=</span> <span class="n">shapeName</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.shp&quot;</span> <span class="o">%</span> <span class="n">shapeName</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Unable to open </span><span class="si">%s</span><span class="s2">.shp&quot;</span> <span class="o">%</span> <span class="n">shapeName</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shx</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.shx&quot;</span> <span class="o">%</span> <span class="n">shapeName</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Unable to open </span><span class="si">%s</span><span class="s2">.shx&quot;</span> <span class="o">%</span> <span class="n">shapeName</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.dbf&quot;</span> <span class="o">%</span> <span class="n">shapeName</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Unable to open </span><span class="si">%s</span><span class="s2">.dbf&quot;</span> <span class="o">%</span> <span class="n">shapeName</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__shpHeader</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dbfHeader</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks to see if the requested shapefile file object is</span>
<span class="sd">        available. If not a ShapefileException is raised.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Shapefile Reader requires a shapefile or file-like object.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shp</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">shpLength</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">f</span>

    <span class="k">def</span> <span class="nf">__restrictIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides list-like handling of a record index with a clearer</span>
<span class="sd">        error message if the index is out of bounds.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numRecords</span><span class="p">:</span>
            <span class="n">rmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numRecords</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">rmax</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Shape or Record index out of range.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">i</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numRecords</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">i</span>

    <span class="k">def</span> <span class="nf">__shpHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads the header information from a .shp or .shx file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Shapefile Reader requires a shapefile or file-like object. (no shp file found&quot;</span><span class="p">)</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shp</span>
        <span class="c1"># File length (16-bit word * 2 = bytes)</span>
        <span class="n">shp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shpLength</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;i&quot;</span><span class="p">,</span> <span class="n">shp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="c1"># Shape type</span>
        <span class="n">shp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span><span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">,</span> <span class="n">shp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># The shapefile&#39;s bounding box (lower left, upper right)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="o">=</span> <span class="n">_Array</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;4d&quot;</span><span class="p">,</span> <span class="n">shp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">32</span><span class="p">)))</span>
        <span class="c1"># Elevation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="n">_Array</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;2d&quot;</span><span class="p">,</span> <span class="n">shp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">)))</span>
        <span class="c1"># Measure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">_Array</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;2d&quot;</span><span class="p">,</span> <span class="n">shp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the header info and geometry for a single shape.&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shp</span><span class="p">)</span>
        <span class="n">record</span> <span class="o">=</span> <span class="n">_Shape</span><span class="p">()</span>
        <span class="n">nParts</span> <span class="o">=</span> <span class="n">nPoints</span> <span class="o">=</span> <span class="n">zmin</span> <span class="o">=</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">mmin</span> <span class="o">=</span> <span class="n">mmax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="p">(</span><span class="n">recNum</span><span class="p">,</span> <span class="n">recLength</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;2i&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
        <span class="c1"># Determine the start of the next record</span>
        <span class="nb">next</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">recLength</span><span class="p">)</span>
        <span class="n">shapeType</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">record</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">=</span> <span class="n">shapeType</span>
        <span class="c1"># For Null shapes create an empty points list for consistency</span>
        <span class="k">if</span> <span class="n">shapeType</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># All shape types capable of having a bounding box</span>
        <span class="k">elif</span> <span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
            <span class="n">record</span><span class="o">.</span><span class="n">bbox</span> <span class="o">=</span> <span class="n">_Array</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;4d&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">32</span><span class="p">)))</span>
        <span class="c1"># Shape types with parts</span>
        <span class="k">if</span> <span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
            <span class="n">nParts</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Shape types with points</span>
        <span class="k">if</span> <span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
            <span class="n">nPoints</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Read parts</span>
        <span class="k">if</span> <span class="n">nParts</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">parts</span> <span class="o">=</span> <span class="n">_Array</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">i&quot;</span> <span class="o">%</span> <span class="n">nParts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nParts</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)))</span>
        <span class="c1"># Read part types for Multipatch - 31</span>
        <span class="k">if</span> <span class="n">shapeType</span> <span class="o">==</span> <span class="mi">31</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">partTypes</span> <span class="o">=</span> <span class="n">_Array</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">i&quot;</span> <span class="o">%</span> <span class="n">nParts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nParts</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)))</span>
        <span class="c1"># Read points - produces a list of [x,y] values</span>
        <span class="k">if</span> <span class="n">nPoints</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">_Array</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;2d&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">)))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nPoints</span><span class="p">)]</span>
        <span class="c1"># Read z extremes and values</span>
        <span class="k">if</span> <span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
            <span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;2d&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
            <span class="n">record</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">_Array</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">d&quot;</span> <span class="o">%</span> <span class="n">nPoints</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nPoints</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)))</span>
        <span class="c1"># Read m extremes and values if header m values do not equal 0.0</span>
        <span class="k">if</span> <span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">:</span>
            <span class="p">(</span><span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;2d&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
            <span class="c1"># Measure values less than -10e38 are nodata values according to the spec</span>
            <span class="n">record</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">_Array</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">d&quot;</span> <span class="o">%</span> <span class="n">nPoints</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nPoints</span> <span class="o">*</span> <span class="mi">8</span><span class="p">))):</span>
                <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">10e38</span><span class="p">:</span>
                    <span class="n">record</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">record</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Read a single point</span>
        <span class="k">if</span> <span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">21</span><span class="p">):</span>
            <span class="n">record</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">_Array</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;2d&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">)))]</span>
        <span class="c1"># Read a single Z value</span>
        <span class="k">if</span> <span class="n">shapeType</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;d&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
        <span class="c1"># Read a single M value</span>
        <span class="k">if</span> <span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">21</span><span class="p">):</span>
            <span class="n">record</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;d&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
        <span class="c1"># Seek to the end of this record as defined by the record header because</span>
        <span class="c1"># the shapefile spec doesn&#39;t require the actual content to meet the header</span>
        <span class="c1"># definition.  Probably allowed for lazy feature deletion.</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">record</span>

    <span class="k">def</span> <span class="nf">__shapeIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the offset in a .shp file for a shape based on information</span>
<span class="sd">        in the .shx index file.&quot;&quot;&quot;</span>
        <span class="n">shx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shx</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">shx</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offsets</span><span class="p">:</span>
            <span class="c1"># File length (16-bit word * 2 = bytes) - header length</span>
            <span class="n">shx</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
            <span class="n">shxRecordLength</span> <span class="o">=</span> <span class="p">(</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;i&quot;</span><span class="p">,</span> <span class="n">shx</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">100</span>
            <span class="n">numRecords</span> <span class="o">=</span> <span class="n">shxRecordLength</span> <span class="o">//</span> <span class="mi">8</span>
            <span class="c1"># Jump to the first record.</span>
            <span class="n">shx</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numRecords</span><span class="p">):</span>
                <span class="c1"># Offsets are 16-bit words just like the file length</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;i&quot;</span><span class="p">,</span> <span class="n">shx</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">shx</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">shx</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offsets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<div class="viewcode-block" id="Reader.shape"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Reader.shape">[docs]</a>    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a shape object for a shape in the the geometry</span>
<span class="sd">        record file.&quot;&quot;&quot;</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shp</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__restrictIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shapeIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">offset</span><span class="p">:</span>
            <span class="c1"># Shx index not available so iterate the full list.</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterShapes</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">k</span>
        <span class="n">shp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span><span class="p">()</span></div>

<div class="viewcode-block" id="Reader.shapes"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Reader.shapes">[docs]</a>    <span class="k">def</span> <span class="nf">shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns all shapes in a shapefile.&quot;&quot;&quot;</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shp</span><span class="p">)</span>
        <span class="c1"># Found shapefiles which report incorrect</span>
        <span class="c1"># shp file length in the header. Can&#39;t trust</span>
        <span class="c1"># that so we seek to the end of the file</span>
        <span class="c1"># and figure it out.</span>
        <span class="n">shp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shpLength</span> <span class="o">=</span> <span class="n">shp</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="n">shp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">shp</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">shpLength</span><span class="p">:</span>
            <span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__shape</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">shapes</span></div>

<div class="viewcode-block" id="Reader.iterShapes"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Reader.iterShapes">[docs]</a>    <span class="k">def</span> <span class="nf">iterShapes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Serves up shapes in a shapefile as an iterator. Useful</span>
<span class="sd">        for handling large shapefiles.&quot;&quot;&quot;</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shp</span><span class="p">)</span>
        <span class="n">shp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shpLength</span> <span class="o">=</span> <span class="n">shp</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="n">shp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">shp</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">shpLength</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__dbfHeaderLength</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves the header length of a dbf file header.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dbfHdrLength</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Shapefile Reader requires a shapefile or file-like object. (no dbf file found)&quot;</span><span class="p">)</span>
            <span class="n">dbf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numRecords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dbfHdrLength</span><span class="p">)</span> <span class="o">=</span> \
                    <span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;xxxxLH22x&quot;</span><span class="p">,</span> <span class="n">dbf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dbfHdrLength</span>

    <span class="k">def</span> <span class="nf">__dbfHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads a dbf header. Xbase-related code borrows heavily from ActiveState Python Cookbook Recipe 362715 by Raymond Hettinger&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Shapefile Reader requires a shapefile or file-like object. (no dbf file found)&quot;</span><span class="p">)</span>
        <span class="n">dbf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span>
        <span class="n">headerLength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dbfHeaderLength</span><span class="p">()</span>
        <span class="n">numFields</span> <span class="o">=</span> <span class="p">(</span><span class="n">headerLength</span> <span class="o">-</span> <span class="mi">33</span><span class="p">)</span> <span class="o">//</span> <span class="mi">32</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numFields</span><span class="p">):</span>
            <span class="n">fieldDesc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;11sc4xBB14x&quot;</span><span class="p">,</span> <span class="n">dbf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">32</span><span class="p">)))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">b</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">fieldDesc</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">fieldDesc</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fieldDesc</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">fieldDesc</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fieldDesc</span><span class="p">[</span><span class="n">name</span><span class="p">][:</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">fieldDesc</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="n">fieldDesc</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="n">fieldDesc</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fieldDesc</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="n">fieldDesc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="n">fieldDesc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fieldDesc</span><span class="p">)</span>
        <span class="n">terminator</span> <span class="o">=</span> <span class="n">dbf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">terminator</span> <span class="o">!=</span> <span class="n">b</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Shapefile dbf header lacks expected terminator. (likely corrupt?)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;DeletionFlag&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__recordFmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the size of a .shp geometry record.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">numRecords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dbfHeader</span><span class="p">()</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">s&#39;</span> <span class="o">%</span> <span class="n">fieldinfo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">fieldinfo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">])</span>
        <span class="n">fmtSize</span> <span class="o">=</span> <span class="n">calcsize</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmtSize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__record</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads and returns a dbf record row as a list of values.&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="p">)</span>
        <span class="n">recFmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__recordFmt</span><span class="p">()</span>
        <span class="n">recordContents</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">recFmt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">recFmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">recordContents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
            <span class="c1"># deleted record</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">record</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">deci</span><span class="p">),</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">,</span>
                                                                                                <span class="n">recordContents</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;DeletionFlag&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span>  <span class="c1"># QGIS NULL is all &#39;*&#39; chars</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">deci</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>  <span class="c1"># QGIS NULL is all &#39;0&#39; chars</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">[:</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="ow">in</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39;YyTt&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">))</span> <span class="ow">or</span> \
                                        <span class="p">(</span><span class="n">value</span> <span class="ow">in</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39;NnFf&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">record</span>

<div class="viewcode-block" id="Reader.record"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Reader.record">[docs]</a>    <span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a specific dbf record based on the supplied index.&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">numRecords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dbfHeader</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__restrictIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">recSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__recordFmt</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dbfHeaderLength</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">recSize</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__record</span><span class="p">()</span></div>

<div class="viewcode-block" id="Reader.records"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Reader.records">[docs]</a>    <span class="k">def</span> <span class="nf">records</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns all records in a dbf file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">numRecords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dbfHeader</span><span class="p">()</span>
        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dbfHeaderLength</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numRecords</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__record</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">records</span></div>

<div class="viewcode-block" id="Reader.iterRecords"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Reader.iterRecords">[docs]</a>    <span class="k">def</span> <span class="nf">iterRecords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Serves up records in a dbf file as an iterator.</span>
<span class="sd">        Useful for large shapefiles or dbf files.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">numRecords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dbfHeader</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dbfHeaderLength</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numRecords</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__record</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">r</span></div>

<div class="viewcode-block" id="Reader.shapeRecord"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Reader.shapeRecord">[docs]</a>    <span class="k">def</span> <span class="nf">shapeRecord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a combination geometry and attribute record for the</span>
<span class="sd">        supplied record index.&quot;&quot;&quot;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__restrictIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_ShapeRecord</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">record</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="Reader.shapeRecords"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Reader.shapeRecords">[docs]</a>    <span class="k">def</span> <span class="nf">shapeRecords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of combination geometry/attribute records for</span>
<span class="sd">        all records in a shapefile.&quot;&quot;&quot;</span>
        <span class="n">shapeRecords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeRecord</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">record</span><span class="o">=</span><span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> \
                                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">())]</span></div>

<div class="viewcode-block" id="Reader.iterShapeRecords"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Reader.iterShapeRecords">[docs]</a>    <span class="k">def</span> <span class="nf">iterShapeRecords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a generator of combination geometry/attribute records for</span>
<span class="sd">        all records in a shapefile.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">shape</span><span class="p">,</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterShapes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterRecords</span><span class="p">()):</span>
            <span class="k">yield</span> <span class="n">_ShapeRecord</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Writer"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer">[docs]</a><span class="k">class</span> <span class="nc">Writer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Provides write support for ESRI Shapefiles.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapeType</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">=</span> <span class="n">shapeType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Geometry record offsets and lengths for writing shx file.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offsets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lengths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Use deletion flags in dbf? Default is false (0).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deletionFlag</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Safety handler to verify file-like objects&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;No file-like object available.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">pth</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pth</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pth</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__shpFileLength</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the file length of the shp file.&quot;&quot;&quot;</span>
        <span class="c1"># Start with header length</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="c1"># Calculate size of all shapes</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">:</span>
            <span class="c1"># Add in record header and shape type fields</span>
            <span class="n">size</span> <span class="o">+=</span> <span class="mi">12</span>
            <span class="c1"># nParts and nPoints do not apply to all shapes</span>
            <span class="c1">#if self.shapeType not in (0,1):</span>
            <span class="c1">#       nParts = len(s.parts)</span>
            <span class="c1">#       nPoints = len(s.points)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s1">&#39;parts&#39;</span><span class="p">):</span>
                <span class="n">nParts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">):</span>
                <span class="n">nPoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="c1"># All shape types capable of having a bounding box</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="mi">32</span>
            <span class="c1"># Shape types with parts</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
                <span class="c1"># Parts count</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="mi">4</span>
                <span class="c1"># Parts index array</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="n">nParts</span> <span class="o">*</span> <span class="mi">4</span>
            <span class="c1"># Shape types with points</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
                <span class="c1"># Points count</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="mi">4</span>
                <span class="c1"># Points array</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">nPoints</span>
            <span class="c1"># Calc size of part types for Multipatch (31)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">==</span> <span class="mi">31</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="n">nParts</span> <span class="o">*</span> <span class="mi">4</span>
            <span class="c1"># Calc z extremes and values</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
                <span class="c1"># z extremes</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="mi">16</span>
                <span class="c1"># z array</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">nPoints</span>
            <span class="c1"># Calc m extremes and values</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
                <span class="c1"># m extremes</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="mi">16</span>
                <span class="c1"># m array</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">nPoints</span>
            <span class="c1"># Calc a single point</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">21</span><span class="p">):</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="mi">16</span>
            <span class="c1"># Calc a single Z value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="mi">8</span>
            <span class="c1"># Calc a single M value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">21</span><span class="p">):</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="mi">8</span>
        <span class="c1"># Calculate size as 16-bit words</span>
        <span class="n">size</span> <span class="o">//=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">size</span>

    <span class="k">def</span> <span class="nf">__bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">shapeTypes</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
            <span class="n">shapeType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span>
            <span class="k">if</span> <span class="n">shapeTypes</span><span class="p">:</span>
                <span class="n">shapeType</span> <span class="o">=</span> <span class="n">shapeTypes</span><span class="p">[</span><span class="n">shapes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
            <span class="n">px</span><span class="p">,</span> <span class="n">py</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">))[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">x</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">px</span><span class="p">)</span>
            <span class="n">y</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">py</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__zbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">shapeTypes</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
                    <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">z</span><span class="p">:</span> <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">z</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__mbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">shapeTypes</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>

<div class="viewcode-block" id="Writer.bbox"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.bbox">[docs]</a>    <span class="k">def</span> <span class="nf">bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the current bounding box for the shapefile which is</span>
<span class="sd">        the lower-left and upper-right corners. It does not contain the</span>
<span class="sd">        elevation or measure extremes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">)</span></div>

<div class="viewcode-block" id="Writer.zbox"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.zbox">[docs]</a>    <span class="k">def</span> <span class="nf">zbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the current z extremes for the shapefile.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__zbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">)</span></div>

<div class="viewcode-block" id="Writer.mbox"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.mbox">[docs]</a>    <span class="k">def</span> <span class="nf">mbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the current m extremes for the shapefile.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__shapefileHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileObj</span><span class="p">,</span> <span class="n">headerType</span><span class="o">=</span><span class="s1">&#39;shp&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes the specified header type to the specified file-like object.</span>
<span class="sd">        Several of the shapefile formats are so similar that a single generic</span>
<span class="sd">        method to read or write them is warranted.&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="n">fileObj</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># File code, Unused bytes</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;6i&quot;</span><span class="p">,</span> <span class="mi">9994</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># File length (Bytes / 2 = 16-bit words)</span>
        <span class="k">if</span> <span class="n">headerType</span> <span class="o">==</span> <span class="s1">&#39;shp&#39;</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;i&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shpFileLength</span><span class="p">()))</span>
        <span class="k">elif</span> <span class="n">headerType</span> <span class="o">==</span> <span class="s1">&#39;shx&#39;</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;i&#39;</span><span class="p">,</span> <span class="p">((</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">))</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="c1"># Version, Shape type</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;2i&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span><span class="p">))</span>
        <span class="c1"># The shapefile&#39;s bounding box (lower left, upper right)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;4d&quot;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">()))</span>
            <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Failed to write shapefile bounding box. Floats required.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;4d&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Elevation</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zbox</span><span class="p">()</span>
        <span class="c1"># Measure</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;4d&quot;</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Failed to write shapefile elevation and measure values. Floats required.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dbfHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes the dbf header and field descriptors.&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">year</span> <span class="o">-=</span> <span class="mi">1900</span>
        <span class="c1"># Remove deletion flag placeholder from fields</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Deletion&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="n">numRecs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">)</span>
        <span class="n">numFields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
        <span class="n">headerLength</span> <span class="o">=</span> <span class="n">numFields</span> <span class="o">*</span> <span class="mi">32</span> <span class="o">+</span> <span class="mi">33</span>
        <span class="n">recordLength</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;BBBBLHH20x&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">numRecs</span><span class="p">,</span>
                <span class="n">headerLength</span><span class="p">,</span> <span class="n">recordLength</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="c1"># Field descriptors</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">fieldType</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">decimal</span> <span class="o">=</span> <span class="n">field</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">))</span>
            <span class="n">fieldType</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">fieldType</span><span class="p">)</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">fld</span> <span class="o">=</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;11sc4xBB14x&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fieldType</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">decimal</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fld</span><span class="p">)</span>
        <span class="c1"># Terminator</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__shpRecords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the shp records&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shp</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">recNum</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">())</span>
            <span class="c1"># Record number, Content length place holder</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;2i&quot;</span><span class="p">,</span> <span class="n">recNum</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">recNum</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="c1"># Shape Type</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">!=</span> <span class="mi">31</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span><span class="p">))</span>
            <span class="c1"># All shape types capable of having a bounding box</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;4d&quot;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">__bbox</span><span class="p">([</span><span class="n">s</span><span class="p">])))</span>
                <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Falied to write bounding box for record </span><span class="si">%s</span><span class="s2">. Expected floats.&quot;</span> <span class="o">%</span> <span class="n">recNum</span><span class="p">)</span>
            <span class="c1"># Shape types with parts</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
                <span class="c1"># Number of parts</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">parts</span><span class="p">)))</span>
            <span class="c1"># Shape types with multiple points per record</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
                <span class="c1"># Number of points</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">)))</span>
            <span class="c1"># Write part indexes</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
            <span class="c1"># Part types for Multipatch (31)</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">==</span> <span class="mi">31</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">partTypes</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">,</span> <span class="n">pt</span><span class="p">))</span>
            <span class="c1"># Write points for multiple-point records</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;2d&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">]</span>
                <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Failed to write points for record </span><span class="si">%s</span><span class="s2">. Expected floats.&quot;</span> <span class="o">%</span> <span class="n">recNum</span><span class="p">)</span>
            <span class="c1"># Write z extremes and values</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;2d&quot;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">__zbox</span><span class="p">([</span><span class="n">s</span><span class="p">])))</span>
                <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Failed to write elevation extremes for record </span><span class="si">%s</span><span class="s2">. Expected floats.&quot;</span> <span class="o">%</span> <span class="n">recNum</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">):</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">d&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">z</span><span class="p">),</span> <span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;d&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">]</span>
                <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Failed to write elevation values for record </span><span class="si">%s</span><span class="s2">. Expected floats.&quot;</span> <span class="o">%</span> <span class="n">recNum</span><span class="p">)</span>
            <span class="c1"># Write m extremes and values</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s2">&quot;m&quot;</span><span class="p">):</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">d&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">m</span><span class="p">),</span> <span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">m</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;2d&quot;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">__mbox</span><span class="p">([</span><span class="n">s</span><span class="p">])))</span>
                <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Failed to write measure extremes for record </span><span class="si">%s</span><span class="s2">. Expected floats&quot;</span> <span class="o">%</span> <span class="n">recNum</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;d&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">]</span>
                <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Failed to write measure values for record </span><span class="si">%s</span><span class="s2">. Expected floats&quot;</span> <span class="o">%</span> <span class="n">recNum</span><span class="p">)</span>
            <span class="c1"># Write a single point</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">21</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;2d&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Failed to write point for record </span><span class="si">%s</span><span class="s2">. Expected floats.&quot;</span> <span class="o">%</span> <span class="n">recNum</span><span class="p">)</span>
            <span class="c1"># Write a single Z value</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">z</span><span class="p">:</span>
                            <span class="n">s</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;d&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Failed to write elevation value for record </span><span class="si">%s</span><span class="s2">. Expected floats.&quot;</span> <span class="o">%</span> <span class="n">recNum</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
                            <span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;d&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Failed to write elevation value for record </span><span class="si">%s</span><span class="s2">. Expected floats.&quot;</span> <span class="o">%</span> <span class="n">recNum</span><span class="p">)</span>
            <span class="c1"># Write a single M value</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">21</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
                            <span class="n">s</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;1d&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Failed to write measure value for record </span><span class="si">%s</span><span class="s2">. Expected floats.&quot;</span> <span class="o">%</span> <span class="n">recNum</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>
                            <span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;1d&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="k">except</span> <span class="n">error</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span><span class="s2">&quot;Failed to write measure value for record </span><span class="si">%s</span><span class="s2">. Expected floats.&quot;</span> <span class="o">%</span> <span class="n">recNum</span><span class="p">)</span>
            <span class="c1"># Finalize record length as 16-bit words</span>
            <span class="n">finish</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="n">length</span> <span class="o">=</span> <span class="p">(</span><span class="n">finish</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
            <span class="c1"># start - 4 bytes is the content length field</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;i&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">finish</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__shxRecords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes the shx records.&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shx</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">)):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;i&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offsets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;i&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">__dbfRecords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes the dbf records.&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Deletion&quot;</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span> <span class="c1"># deletion flag</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">fieldName</span><span class="p">,</span> <span class="n">fieldType</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">dec</span><span class="p">),</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
                <span class="n">fieldType</span> <span class="o">=</span> <span class="n">fieldType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fieldType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">fieldType</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">fieldType</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">day</span><span class="p">]])[:</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">DATE_EXP</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="n">DATE_EXP</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)[:</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)[:</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)[:</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)[:</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)[:</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">size</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ShapefileException</span><span class="p">(</span>
                        <span class="s2">&quot;Shapefile Writer unable to pack incorrect sized value&quot;</span>
                        <span class="s2">&quot; (size </span><span class="si">%d</span><span class="s2">) into field &#39;</span><span class="si">%s</span><span class="s2">&#39; (size </span><span class="si">%d</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">fieldName</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="Writer.null"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.null">[docs]</a>    <span class="k">def</span> <span class="nf">null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a null shape.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_Shape</span><span class="p">(</span><span class="n">NULL</span><span class="p">))</span></div>

<div class="viewcode-block" id="Writer.point"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.point">[docs]</a>    <span class="k">def</span> <span class="nf">point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a point shape.&quot;&quot;&quot;</span>
        <span class="n">pointShape</span> <span class="o">=</span> <span class="n">_Shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span><span class="p">)</span>
        <span class="n">pointShape</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">m</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pointShape</span><span class="p">)</span></div>

<div class="viewcode-block" id="Writer.line"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.line">[docs]</a>    <span class="k">def</span> <span class="nf">line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="p">[],</span> <span class="n">shapeType</span><span class="o">=</span><span class="n">POLYLINE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a line shape. This method is just a convienience method</span>
<span class="sd">        which wraps &#39;poly()&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">shapeType</span><span class="p">,</span> <span class="p">[])</span></div>

<div class="viewcode-block" id="Writer.poly"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.poly">[docs]</a>    <span class="k">def</span> <span class="nf">poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="p">[],</span> <span class="n">shapeType</span><span class="o">=</span><span class="n">POLYGON</span><span class="p">,</span> <span class="n">partTypes</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Creates a shape that has multiple collections of points (parts)</span>
<span class="sd">        including lines, polygons, and even multipoint shapes. If no shape type</span>
<span class="sd">        is specified it defaults to &#39;polygon&#39;. If no part types are specified</span>
<span class="sd">        (which they normally won&#39;t be) then all parts default to the shape type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">polyShape</span> <span class="o">=</span> <span class="n">_Shape</span><span class="p">(</span><span class="n">shapeType</span><span class="p">)</span>
        <span class="n">polyShape</span><span class="o">.</span><span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">polyShape</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Make sure polygons are closed</span>
        <span class="k">if</span> <span class="n">shapeType</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">part</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
            <span class="n">polyShape</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">polyShape</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">part</span><span class="p">:</span>
                <span class="c1"># Ensure point is list</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">point</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
                <span class="c1"># Make sure point has z and m values</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">point</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">polyShape</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">polyShape</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">==</span> <span class="mi">31</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">partTypes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">partTypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polyShape</span><span class="o">.</span><span class="n">shapeType</span><span class="p">)</span>
            <span class="n">polyShape</span><span class="o">.</span><span class="n">partTypes</span> <span class="o">=</span> <span class="n">partTypes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polyShape</span><span class="p">)</span></div>

<div class="viewcode-block" id="Writer.field"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.field">[docs]</a>    <span class="k">def</span> <span class="nf">field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fieldType</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;50&quot;</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a dbf field descriptor to the shapefile.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">fieldType</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">decimal</span><span class="p">))</span></div>

<div class="viewcode-block" id="Writer.record"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.record">[docs]</a>    <span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">recordList</span><span class="p">,</span> <span class="o">**</span><span class="n">recordDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a dbf attribute record. You can submit either a sequence of</span>
<span class="sd">        field values or keyword arguments of field names and values. Before</span>
<span class="sd">        adding records you must add fields for the record values using the</span>
<span class="sd">        fields() method. If the record values exceed the number of fields the</span>
<span class="sd">        extra ones won&#39;t be added. In the case of using keyword arguments to specify</span>
<span class="sd">        field/value pairs only fields matching the already registered fields</span>
<span class="sd">        will be added.&quot;&quot;&quot;</span>
        <span class="n">record</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fieldCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
        <span class="c1"># Compensate for deletion flag</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Deletion&quot;</span><span class="p">):</span> <span class="n">fieldCount</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">recordList</span><span class="p">:</span>
            <span class="p">[</span><span class="n">record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recordList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fieldCount</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">recordDict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">recordDict</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">recordDict</span><span class="p">[</span><span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="p">)</span></div>

<div class="viewcode-block" id="Writer.shape"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.shape">[docs]</a>    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

<div class="viewcode-block" id="Writer.shapes"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.shapes">[docs]</a>    <span class="k">def</span> <span class="nf">shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the current list of shapes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span></div>

<div class="viewcode-block" id="Writer.saveShp"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.saveShp">[docs]</a>    <span class="k">def</span> <span class="nf">saveShp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save an shp file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">):</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">target</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.shp&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shapeType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__shapefileHeader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shp</span><span class="p">,</span> <span class="n">headerType</span><span class="o">=</span><span class="s1">&#39;shp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__shpRecords</span><span class="p">()</span></div>

<div class="viewcode-block" id="Writer.saveShx"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.saveShx">[docs]</a>    <span class="k">def</span> <span class="nf">saveShx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save an shx file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">):</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">target</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.shx&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shapeType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__shapefileHeader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shx</span><span class="p">,</span> <span class="n">headerType</span><span class="o">=</span><span class="s1">&#39;shx&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__shxRecords</span><span class="p">()</span></div>

<div class="viewcode-block" id="Writer.saveDbf"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.saveDbf">[docs]</a>    <span class="k">def</span> <span class="nf">saveDbf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save a dbf file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">):</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">target</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.dbf&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getFileObj</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dbfHeader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dbfRecords</span><span class="p">()</span></div>

<div class="viewcode-block" id="Writer.save"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Writer.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dbf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the shapefile data to three files or</span>
<span class="sd">        three file-like objects. SHP and DBF files can also</span>
<span class="sd">        be written exclusively using saveShp, saveShx, and saveDbf respectively.</span>
<span class="sd">        If target is specified but not shp,shx, or dbf then the target path and</span>
<span class="sd">        file name are used.  If no options or specified, a unique base file name</span>
<span class="sd">        is generated to save the files and the base file name is returned as a</span>
<span class="sd">        string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a unique file name if one is not defined</span>
        <span class="k">if</span> <span class="n">shp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveShp</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveShx</span><span class="p">(</span><span class="n">shx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dbf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveDbf</span><span class="p">(</span><span class="n">dbf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">shp</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">shx</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dbf</span><span class="p">:</span>
            <span class="n">generated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;shapefile_&quot;</span><span class="p">,</span><span class="nb">dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">name</span>
                <span class="n">generated</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveShp</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveShx</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shx</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveDbf</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">generated</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">target</span></div></div>
<div class="viewcode-block" id="Editor"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Editor">[docs]</a><span class="k">class</span> <span class="nc">Editor</span><span class="p">(</span><span class="n">Writer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shapeType</span><span class="o">=</span><span class="n">POINT</span><span class="p">,</span> <span class="n">autoBalance</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoBalance</span> <span class="o">=</span> <span class="n">autoBalance</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">shapefile</span><span class="p">:</span>
            <span class="n">Writer</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapeType</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_string</span><span class="p">(</span><span class="n">shapefile</span><span class="p">):</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">shapefile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.shp&quot;</span> <span class="o">%</span> <span class="n">base</span><span class="p">):</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
                <span class="n">Writer</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">shapeType</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">shapes</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">fields</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">records</span><span class="p">()</span>

<div class="viewcode-block" id="Editor.select"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Editor.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select one or more shapes (to be implemented)&quot;&quot;&quot;</span>
        <span class="c1"># TODO: Implement expressions to select shapes.</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Editor.delete"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Editor.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes the specified part of any shape by specifying a shape</span>
<span class="sd">        number, part number, or point number.&quot;&quot;&quot;</span>
        <span class="c1"># shape, part, point</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">and</span> <span class="n">point</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">point</span><span class="p">]</span>
        <span class="c1"># shape, part</span>
        <span class="k">elif</span> <span class="n">shape</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">point</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">][</span><span class="n">part</span><span class="p">]</span>
        <span class="c1"># shape</span>
        <span class="k">elif</span> <span class="n">shape</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">part</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">point</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">]</span>
        <span class="c1"># point</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">shape</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">part</span> <span class="ow">and</span> <span class="n">point</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">point</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">part</span><span class="p">][</span><span class="n">point</span><span class="p">]</span>
        <span class="c1"># part, point</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">shape</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">and</span> <span class="n">point</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">part</span><span class="p">][</span><span class="n">point</span><span class="p">]</span>
        <span class="c1"># part</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">shape</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">point</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">s</span><span class="p">[</span><span class="n">part</span><span class="p">]</span></div>

<div class="viewcode-block" id="Editor.point"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Editor.point">[docs]</a>    <span class="k">def</span> <span class="nf">point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">addr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates/updates a point shape. The arguments allows</span>
<span class="sd">        you to update a specific point by shape, part, point of any</span>
<span class="sd">        shape type.&quot;&quot;&quot;</span>
        <span class="c1"># shape, part, point</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">and</span> <span class="n">point</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">][</span><span class="n">part</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">point</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">][</span><span class="n">part</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">point</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">if</span> <span class="n">z</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">point</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
        <span class="c1"># shape, part</span>
        <span class="k">elif</span> <span class="n">shape</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">point</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">][</span><span class="n">part</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">][</span><span class="n">part</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                <span class="k">if</span> <span class="n">y</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
                <span class="k">if</span> <span class="n">z</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
        <span class="c1"># shape</span>
        <span class="k">elif</span> <span class="n">shape</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">part</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">point</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

        <span class="c1"># point</span>
        <span class="c1"># part</span>
        <span class="k">if</span> <span class="n">addr</span><span class="p">:</span>
            <span class="n">shape</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="n">point</span> <span class="o">=</span> <span class="n">addr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">[</span><span class="n">shape</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">point</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Writer</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoBalance</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">()</span></div>

<div class="viewcode-block" id="Editor.validate"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Editor.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An optional method to try and validate the shapefile</span>
<span class="sd">        as much as possible before writing it (not implemented).&quot;&quot;&quot;</span>
        <span class="c1">#TODO: Implement validation method</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Editor.balance"><a class="viewcode-back" href="../../../restapi.shapefile/#restapi.shapefile.Editor.balance">[docs]</a>    <span class="k">def</span> <span class="nf">balance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a corresponding empty attribute or null geometry record depending</span>
<span class="sd">        on which type of record was created to make sure all three files</span>
<span class="sd">        are in synch.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">null</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shapes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">record</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__fieldNorm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fieldName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Normalizes a dbf field name to fit within the spec and the</span>
<span class="sd">        expectations of certain ESRI software.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fieldName</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">:</span> <span class="n">fieldName</span> <span class="o">=</span> <span class="n">fieldName</span><span class="p">[:</span><span class="mi">11</span><span class="p">]</span>
        <span class="n">fieldName</span> <span class="o">=</span> <span class="n">fieldName</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">fieldName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../">restapi</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../">Documentation overview</a><ul>
  <li><a href="../../">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Caleb Mackey.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>