
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>restapi.arc_restapi &#8212; restapi  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for restapi.arc_restapi</h1><div class="highlight"><pre>
<span></span><span class="c1"># proprietary version (uses arcpy)</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">arcpy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">.rest_utils</span> <span class="k">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">six</span>
<span class="kn">from</span> <span class="nn">.six.moves</span> <span class="k">import</span> <span class="nb">range</span>
<span class="kn">from</span> <span class="nn">.six.moves</span> <span class="k">import</span> <span class="n">urllib</span>

<span class="c1"># support for both ArcGIS Desktop and Pro layers</span>
<span class="n">ARCPY_LAYER_TYPE</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">Layer</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">arcpy</span><span class="p">,</span> <span class="s1">&#39;mapping&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">_mp</span><span class="o">.</span><span class="n">Layer</span>

<span class="c1"># environments</span>
<span class="n">arcpy</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">overwriteOutput</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">arcpy</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">addOutputsToMap</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="find_ws_type"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.find_ws_type">[docs]</a><span class="k">def</span> <span class="nf">find_ws_type</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determines output workspace (feature class if not FileSystem).</span>
<span class="sd">        returns a tuple of workspace path and type.</span>
<span class="sd">    </span>
<span class="sd">    Arg:</span>
<span class="sd">        path: Path for workspace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
 
    <span class="c1"># try original path first</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="n">desc</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Describe</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="s1">&#39;workspaceType&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="n">desc</span><span class="o">.</span><span class="n">workspaceType</span>

    <span class="c1"># search until finding a valid workspace</span>
    <span class="n">split</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># find valid workspace</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">split</span><span class="p">)):</span>
        <span class="n">sub_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">split</span><span class="p">[:</span><span class="o">-</span><span class="n">i</span><span class="p">])</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Describe</span><span class="p">(</span><span class="n">sub_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="s1">&#39;workspaceType&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">sub_dir</span><span class="p">,</span> <span class="n">desc</span><span class="o">.</span><span class="n">workspaceType</span></div>

<div class="viewcode-block" id="Geometry"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.Geometry">[docs]</a><span class="k">class</span> <span class="nc">Geometry</span><span class="p">(</span><span class="n">BaseGeometry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to handle restapi.Geometry.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        geometryType: The type of geometry.</span>
<span class="sd">        json: JSON object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts geometry input to restapi.Geometry object.</span>

<span class="sd">        Arg:</span>
<span class="sd">            geometry: Input geometry.  Can be arcpy.Geometry(), shapefile/feature</span>
<span class="sd">                class, or JSON.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: &quot;Not a valid geometry input!&quot;</span>
<span class="sd">            ValueError: &quot;Not a vaild JSON object!&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_inputGeometry</span> <span class="o">=</span> <span class="n">geometry</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">json</span>
        <span class="n">spatialReference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_wkid</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">spatialReference</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spatialReference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_wkid</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GEOMETRY_TYPE</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GEOMETRY_TYPE</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;esri&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">json</span> <span class="o">=</span> <span class="n">munch</span><span class="o">.</span><span class="n">Munch</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">ARCPY_LAYER_TYPE</span><span class="p">)</span> <span class="ow">and</span> <span class="n">geometry</span><span class="o">.</span><span class="n">supports</span><span class="p">(</span><span class="s1">&#39;DATASOURCE&#39;</span><span class="p">):</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">dataSource</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="p">(</span><span class="n">arcpy</span><span class="o">.</span><span class="n">RecordSet</span><span class="p">,</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">FeatureSet</span><span class="p">)):</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">FeatureSet</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">JSON</span><span class="p">)</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">json</span>
            <span class="n">spatialReference</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">getSR</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Geometry</span><span class="p">):</span>
            <span class="n">spatialReference</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">spatialReference</span><span class="o">.</span><span class="n">factoryCode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="s1">&#39;esriGeometry</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
            <span class="n">esri_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">JSON</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">esri_json</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="n">SPATIAL_REFERENCE</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">SPATIAL_REFERENCE</span> <span class="ow">in</span> <span class="n">esri_json</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">SPATIAL_REFERENCE</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatialReference</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_wkid</span><span class="p">(</span><span class="n">esri_json</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">geometry</span> <span class="o">=</span> <span class="n">OrderedDict2</span><span class="p">(</span><span class="o">**</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">geometry</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># maybe it&#39;s a shapefile/feature class?</span>
                <span class="k">if</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">geometry</span><span class="p">):</span>
                    <span class="n">desc</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Describe</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
                    <span class="n">spatialReference</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">spatialReference</span><span class="o">.</span><span class="n">factoryCode</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="s1">&#39;esriGeometry</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">desc</span><span class="o">.</span><span class="n">shapeType</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
                    <span class="k">with</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">SearchCursor</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;SHAPE@JSON&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="n">rows</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                            <span class="n">esri_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">break</span>

                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">esri_json</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="n">SPATIAL_REFERENCE</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                    <span class="k">if</span> <span class="n">SPATIAL_REFERENCE</span> <span class="ow">in</span> <span class="n">esri_json</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">SPATIAL_REFERENCE</span><span class="p">]</span> <span class="o">=</span> <span class="n">esri_json</span><span class="p">[</span><span class="n">SPATIAL_REFERENCE</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Not a valid geometry input!&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">FEATURES</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="n">FEATURES</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">GEOMETRY</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="n">FEATURES</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">GEOMETRY</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="n">GEOMETRY</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="n">GEOMETRY</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">RINGS</span> <span class="ow">in</span> <span class="n">geometry</span> <span class="ow">or</span> <span class="n">CURVE_RINGS</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">RINGS</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">RINGS</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="n">RINGS</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">CURVE_RINGS</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="n">CURVE_RINGS</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">GEOM_DICT</span><span class="p">[</span><span class="n">RINGS</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">PATHS</span> <span class="ow">in</span> <span class="n">geometry</span> <span class="ow">or</span> <span class="n">CURVE_PATHS</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">PATHS</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">PATHS</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="n">PATHS</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">CURVE_PATHS</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="n">CURVE_PATHS</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">GEOM_DICT</span><span class="p">[</span><span class="n">PATHS</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">POINTS</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">POINTS</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="n">POINTS</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">GEOM_DICT</span><span class="p">[</span><span class="n">POINTS</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">geometry</span> <span class="ow">and</span> <span class="n">Y</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="n">X</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">ESRI_POINT</span>
                <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">,</span> <span class="p">[</span><span class="n">XMIN</span><span class="p">,</span> <span class="n">YMIN</span><span class="p">,</span> <span class="n">XMAX</span><span class="p">,</span> <span class="n">YMAX</span><span class="p">])):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">XMIN</span><span class="p">,</span> <span class="n">YMIN</span><span class="p">,</span> <span class="n">XMAX</span><span class="p">,</span> <span class="n">YMAX</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">ESRI_ENVELOPE</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Not a valid JSON object!&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="ow">and</span> <span class="n">GEOMETRY_TYPE</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="n">GEOMETRY_TYPE</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">SPATIAL_REFERENCE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="n">spatialReference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spatialReference</span> <span class="o">=</span> <span class="n">spatialReference</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">RINGS</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">ESRI_POLYGON</span>
            <span class="k">elif</span> <span class="n">PATHS</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">ESRI_POLYLINE</span>
            <span class="k">elif</span> <span class="n">POINTS</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">ESRI_MULTIPOINT</span>
            <span class="k">elif</span> <span class="n">X</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="n">Y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">ESRI_POINT</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">NULL_GEOMETRY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasCurves</span> <span class="o">=</span> <span class="n">CURVE_PATHS</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span> <span class="ow">or</span> <span class="n">CURVE_RINGS</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span>

<div class="viewcode-block" id="Geometry.envelope"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.Geometry.envelope">[docs]</a>    <span class="k">def</span> <span class="nf">envelope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an envelope from shape.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">!=</span> <span class="n">ESRI_ENVELOPE</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">AsShape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">extent</span>
            <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">XMin</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">YMin</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">XMax</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">YMax</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">XMIN</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">YMIN</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">XMAX</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">YMAX</span><span class="p">]]))</span></div>

<div class="viewcode-block" id="Geometry.envelopeAsJSON"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.Geometry.envelopeAsJSON">[docs]</a>    <span class="k">def</span> <span class="nf">envelopeAsJSON</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">featureBuffer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">roundCoordinates</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an envelope geometry object as JSON.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            featureBuffer: Optional buffer for the feature, defaults to 0.</span>
<span class="sd">            roundCoordinates: Optional boolean arg, determines if coordinates are </span>
<span class="sd">                rounded. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">!=</span> <span class="n">ESRI_ENVELOPE</span><span class="p">:</span>
            <span class="n">flds</span> <span class="o">=</span> <span class="p">[</span><span class="n">XMIN</span><span class="p">,</span> <span class="n">YMIN</span><span class="p">,</span> <span class="n">XMAX</span><span class="p">,</span> <span class="n">YMAX</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">roundCoordinates</span><span class="p">:</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">envelope</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">envelope</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">flds</span><span class="p">,</span> <span class="n">coords</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SPATIAL_REFERENCE</span><span class="p">):</span>
            <span class="n">d</span><span class="p">[</span><span class="n">SPATIAL_REFERENCE</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">SPATIAL_REFERENCE</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">featureBuffer</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;min&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v before&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">-</span>  <span class="n">featureBuffer</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v after&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s1">&#39;max&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">featureBuffer</span>
        <span class="k">return</span> <span class="n">munch</span><span class="o">.</span><span class="n">munchify</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geometry.asShape"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.Geometry.asShape">[docs]</a>    <span class="k">def</span> <span class="nf">asShape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns JSON as arcpy.Geometry() object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">!=</span> <span class="n">ESRI_ENVELOPE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">AsShape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ar</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Array</span><span class="p">([</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">XMIN</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">YMAX</span><span class="p">]),</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">XMAX</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">YMAX</span><span class="p">]),</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">XMAX</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">YMIN</span><span class="p">]),</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">XMIN</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">YMIN</span><span class="p">])</span>
            <span class="p">])</span>
            <span class="k">return</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatialReference</span><span class="p">))</span></div>

<div class="viewcode-block" id="Geometry.toPolygon"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.Geometry.toPolygon">[docs]</a>    <span class="k">def</span> <span class="nf">toPolygon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a polygon that is converted from geometry.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GEOMETRY_TYPE</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GEOMETRY_TYPE</span><span class="p">)</span> <span class="o">==</span> <span class="n">ESRI_ENVELOPE</span><span class="p">:</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ext</span><span class="p">:</span>
                    <span class="n">rings</span> <span class="o">=</span> <span class="p">[[</span>
                        <span class="p">[</span><span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">XMIN</span><span class="p">,</span> <span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">YMIN</span><span class="p">))],</span>
                        <span class="p">[</span><span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">XMIN</span><span class="p">,</span> <span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">YMAX</span><span class="p">))],</span>
                        <span class="p">[</span><span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">XMAX</span><span class="p">,</span> <span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">YMAX</span><span class="p">))],</span>
                        <span class="p">[</span><span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">XMAX</span><span class="p">,</span> <span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">YMIN</span><span class="p">))],</span>
                        <span class="p">[</span><span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">XMIN</span><span class="p">,</span> <span class="n">ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">YMIN</span><span class="p">))],</span>
                    <span class="p">]]</span>

                    <span class="k">return</span> <span class="n">Geometry</span><span class="p">({</span>
                        <span class="n">SPATIAL_REFERENCE</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spatialReference</span><span class="p">,</span>
                        <span class="n">RINGS</span><span class="p">:</span> <span class="n">rings</span>
                    <span class="p">})</span></div>


    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dumps JSON to string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeometryCollection"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.GeometryCollection">[docs]</a><span class="k">class</span> <span class="nc">GeometryCollection</span><span class="p">(</span><span class="n">BaseGeometryCollection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents an array of restapi.Geometry objects.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        geometries: A single geomtry or list of geometries.</span>
<span class="sd">        json = A JSON object.</span>
<span class="sd">        geometryType: The type of geometry.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometries</span><span class="p">,</span> <span class="n">use_envelopes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">spatialReference</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Represents an array of restapi.Geometry objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            geometries: A single geometry or a list of geometries.  Valid inputs</span>
<span class="sd">                are a shapefile|feature class|Layer, geometry as JSON, a </span>
<span class="sd">                restapi.Geometry, or restapi.FeatureSet.</span>
<span class="sd">            use_envelopes: Optional boolean, if set to true, will use the bounding </span>
<span class="sd">                box of each geometry passed in for the JSON attribute.</span>
<span class="sd">            spatialReference: Optional spatial reference. Defaults to None.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: &#39;Inputs are not valid ESRI JSON Geometries!!!&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span> <span class="o">=</span> <span class="n">geometries</span><span class="o">.</span><span class="n">geometries</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">json</span> <span class="o">=</span> <span class="n">geometries</span><span class="o">.</span><span class="n">json</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="n">geometries</span><span class="o">.</span><span class="n">geometryType</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># if it is a dict, see if it is actually a feature set, then go through the rest of the filters</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>  <span class="ow">and</span> <span class="n">GEOMETRIES</span> <span class="ow">in</span> <span class="n">geometries</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="n">FeatureSet</span><span class="p">):</span>
                <span class="c1"># it is already a GeometryCollection in ESRI JSON format?</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span> <span class="o">=</span> <span class="p">[</span><span class="n">Geometry</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">[</span><span class="n">GEOMETRIES</span><span class="p">]]</span>

            <span class="c1"># it is a layer or feature class/shapefile</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="n">ARCPY_LAYER_TYPE</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">SearchCursor</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;SHAPE@&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="n">rows</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span> <span class="o">=</span> <span class="p">[</span><span class="n">Geometry</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">geometries</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">geometries</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">geometries</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">SearchCursor</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;SHAPE@&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="n">rows</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span> <span class="o">=</span> <span class="p">[</span><span class="n">Geometry</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gd</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">geometries</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gd</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">gd</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Inputs are not valid ESRI JSON Geometries!!!&#39;</span><span class="p">)</span>

            <span class="c1"># it is already a list</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>

                <span class="c1"># it is a list of restapi.Geometry() objects</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">Geometry</span><span class="p">),</span> <span class="n">geometries</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span> <span class="o">=</span> <span class="n">geometries</span>

                <span class="c1"># it is a JSON structure either as dict or string</span>
                <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)),</span> <span class="n">geometries</span><span class="p">)):</span>

                    <span class="c1"># this *should* be JSON, right???</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span> <span class="o">=</span> <span class="p">[</span><span class="n">Geometry</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Inputs are not valid ESRI JSON Geometries!!!&#39;</span><span class="p">)</span>

            <span class="c1"># it is a FeatureSet</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="n">FeatureSet</span><span class="p">):</span>
                <span class="n">fs</span> <span class="o">=</span> <span class="n">geometries</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">Geometry</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">spatialReference</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">getWKID</span><span class="p">(),</span> <span class="n">geometryType</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">geometryType</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fs</span><span class="o">.</span><span class="n">features</span><span class="p">])</span>

            <span class="c1"># it is a JSON struture of geometries already</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">GEOMETRIES</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">:</span>
                    <span class="c1"># it is already a GeometryCollection in ESRI JSON format?</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span> <span class="o">=</span> <span class="p">[</span><span class="n">Geometry</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">geometries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GEOMETRIES</span><span class="p">,</span> <span class="p">[])]</span>
                <span class="k">elif</span> <span class="n">FEATURES</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span> <span class="o">=</span> <span class="p">[</span><span class="n">Geometry</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">geometries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FEATURES</span><span class="p">,</span> <span class="p">[])]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Inputs are not valid ESRI JSON Geometries!!!&#39;</span><span class="p">)</span>

            <span class="c1"># it is a single Geometry object</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="n">Geometry</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geometries</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">GEOMETRIES</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">spatialReference</span><span class="p">:</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">spatialReference</span> <span class="o">=</span> <span class="n">spatialReference</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">GEOMETRIES</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">envelopeAsJSON</span><span class="p">()</span> <span class="k">if</span> <span class="n">use_envelopes</span> <span class="k">else</span> <span class="n">g</span><span class="o">.</span><span class="n">json</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="n">GEOMETRY_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">geometryType</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">use_envelopes</span> <span class="k">else</span> <span class="n">ESRI_ENVELOPE</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geometryType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">geometryType</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">spatialReference</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">spatialReference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spatialReference</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Inputs are not valid ESRI JSON Geometries!!!&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">json</span> <span class="o">=</span> <span class="n">munch</span><span class="o">.</span><span class="n">munchify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spatialReference</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spatialReference</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@spatialReference</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">spatialReference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wkid</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometries</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">spatialReference</span> <span class="o">=</span> <span class="n">wkid</span></div>

<div class="viewcode-block" id="GeocodeHandler"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.GeocodeHandler">[docs]</a><span class="k">class</span> <span class="nc">GeocodeHandler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to handle geocode results.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        results: Results from the geocode.</span>
<span class="sd">        spatailReference: Spatial reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geocodeResult</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Geocode response object handler</span>

<span class="sd">        Arg:</span>
<span class="sd">            geocodeResult: GeocodeResult object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">geocodeResult</span><span class="o">.</span><span class="n">results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spatialReference</span> <span class="o">=</span> <span class="n">geocodeResult</span><span class="o">.</span><span class="n">spatialReference</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns collections.namedtuple with (name, type).&quot;&quot;&quot;</span>
        <span class="n">res_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">__fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">res_sample</span><span class="o">.</span><span class="n">attributes</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">3.4E38</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">1.2E38</span><span class="p">:</span>
                    <span class="n">__fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FIELD_SCHEMA</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;FLOAT&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">__fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FIELD_SCHEMA</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;DOUBLE&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">integer_types</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">32768</span><span class="p">:</span>
                    <span class="n">__fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FIELD_SCHEMA</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;SHORT&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">__fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FIELD_SCHEMA</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;LONG&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">__fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FIELD_SCHEMA</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;TEXT&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">__fields</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">formattedResults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a generator with formated results as tuple.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">PointGeometry</span><span class="p">(</span><span class="n">arcpy</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="n">X</span><span class="p">],</span>
                                                 <span class="n">res</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="n">Y</span><span class="p">]),</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">spatialReference</span><span class="p">)</span>

            <span class="k">yield</span> <span class="p">(</span><span class="n">pt</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geocoder"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.Geocoder">[docs]</a><span class="k">class</span> <span class="nc">Geocoder</span><span class="p">(</span><span class="n">GeocodeService</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class that handles geocoding. Inherits GeocodeService.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="Geocoder.exportResults"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.Geocoder.exportResults">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">exportResults</span><span class="p">(</span><span class="n">geocodeResultObject</span><span class="p">,</span> <span class="n">out_fc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exports the geocode results (GeocodeResult object) to feature class.</span>

<span class="sd">        Args:</span>
<span class="sd">            geocodeResultObject: Results from geocode operation, must be of type</span>
<span class="sd">                GeocodeResult.</span>
<span class="sd">            out_fc: Full path to output feature class.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            TypeError: &quot;{} is not a {} object!&quot;</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            The path to the output feature class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geocodeResultObject</span><span class="p">,</span> <span class="n">GeocodeResult</span><span class="p">):</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">GeocodeHandler</span><span class="p">(</span><span class="n">geocodeResultObject</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">handler</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Geocoder returned 0 results! Did not create output&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="c1"># make feature class</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out_fc</span><span class="p">)</span>
            <span class="n">arcpy</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">CreateFeatureclass</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;POINT&#39;</span><span class="p">,</span> <span class="n">spatial_reference</span><span class="o">=</span><span class="n">handler</span><span class="o">.</span><span class="n">spatialReference</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">handler</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">AddField</span><span class="p">(</span><span class="n">out_fc</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">field_length</span><span class="o">=</span><span class="mi">254</span><span class="p">)</span>

            <span class="c1"># add records</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SHAPE@&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">handler</span><span class="o">.</span><span class="n">fields</span><span class="p">]</span>
            <span class="k">with</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">InsertCursor</span><span class="p">(</span><span class="n">out_fc</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span> <span class="k">as</span> <span class="n">irows</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">handler</span><span class="o">.</span><span class="n">formattedResults</span><span class="p">:</span>
                    <span class="n">irows</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Created: &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_fc</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">out_fc</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a </span><span class="si">{}</span><span class="s1"> object!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geocodeResultObject</span><span class="p">,</span> <span class="n">GeocodeResult</span><span class="p">))</span></div></div>

<span class="c1"># ARCPY UTILITIES - only available here</span>
<div class="viewcode-block" id="create_empty_schema"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.create_empty_schema">[docs]</a><span class="k">def</span> <span class="nf">create_empty_schema</span><span class="p">(</span><span class="n">feature_set</span><span class="p">,</span> <span class="n">out_fc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates empty schema in a feature class.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        feature_set: Input feature set.</span>
<span class="sd">        out_fc: Output feature class path.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        A feature class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make copy of feature set</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">feature_set</span><span class="o">.</span><span class="n">getEmptyCopy</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># this tool has been very buggy in the past :(</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tmp_json_file</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">arcpy</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">JSONToFeatures</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">out_fc</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># this isn&#39;t much better..</span>
            <span class="n">gp</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">geoprocessing</span><span class="o">.</span><span class="n">_base</span><span class="o">.</span><span class="n">Geoprocessor</span><span class="p">()</span>

            <span class="c1"># create arcpy.FeatureSet from raw JSON string</span>
            <span class="n">arcpy_fs</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">fromEsriJson</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
            <span class="n">arcpy_fs</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">out_fc</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># manually add records with insert cursor, this is SLOW!</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;arcpy conversion failed, manually writing features...&#39;</span><span class="p">)</span>
        <span class="n">outSR</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">getSR</span><span class="p">())</span>
        <span class="n">path</span><span class="p">,</span> <span class="n">fc_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out_fc</span><span class="p">)</span>
        <span class="n">g_type</span> <span class="o">=</span> <span class="n">G_DICT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">geometryType</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">arcpy</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">CreateFeatureclass</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fc_name</span><span class="p">,</span> <span class="n">g_type</span><span class="p">,</span>
                                        <span class="n">spatial_reference</span><span class="o">=</span><span class="n">outSR</span><span class="p">)</span>

        <span class="c1"># add all fields</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fs</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">OID</span><span class="p">,</span> <span class="n">SHAPE</span><span class="p">]</span> <span class="o">+</span> <span class="n">SKIP_FIELDS</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;shape.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="n">field_name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#for weird SDE fields with periods</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">field_name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)])</span> <span class="c1">#keep geometry calcs if shapefile</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">field_name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span>


                <span class="c1"># need to filter even more as SDE sometimes yields weird field names...sigh</span>
                <span class="n">restricted</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;fid&#39;</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="s1">&#39;objectid&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="s1">&#39;shape_&#39;</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                            <span class="s1">&#39;shape.&#39;</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                            <span class="s1">&#39;(shape)&#39;</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span> \
                            <span class="ow">or</span> <span class="n">isShp</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">restricted</span><span class="p">:</span>
                    <span class="n">field_length</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">length</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="n">arcpy</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">AddField</span><span class="p">(</span><span class="n">out_fc</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">FTYPES</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="p">],</span>
                                                <span class="n">field_length</span><span class="o">=</span><span class="n">field_length</span><span class="p">,</span>
                                                <span class="n">field_alias</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">alias</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out_fc</span></div>

<div class="viewcode-block" id="add_domains_from_feature_set"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.add_domains_from_feature_set">[docs]</a><span class="k">def</span> <span class="nf">add_domains_from_feature_set</span><span class="p">(</span><span class="n">out_fc</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds domains from a feature set to a feature class.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        out_fc: The output feature class path.</span>
<span class="sd">        fs: Input feature set.</span>
<span class="sd">    &quot;&quot;&quot;</span> 

    <span class="c1"># find workspace type and path</span>
    <span class="n">ws</span><span class="p">,</span> <span class="n">wsType</span> <span class="o">=</span> <span class="n">find_ws_type</span><span class="p">(</span><span class="n">out_fc</span><span class="p">)</span>
    <span class="n">isShp</span> <span class="o">=</span> <span class="n">wsType</span> <span class="o">==</span> <span class="s1">&#39;FileSystem&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">isShp</span><span class="p">:</span>
            <span class="n">gdb_domains</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Describe</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">domains</span>
            <span class="n">dom_map</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fs</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">DOMAIN</span><span class="p">):</span>
                    <span class="n">field_name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">dom_map</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="p">[</span><span class="n">NAME</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="p">[</span><span class="n">NAME</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gdb_domains</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">CODED_VALUES</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="p">:</span>
                            <span class="n">dType</span> <span class="o">=</span> <span class="n">CODED</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dType</span> <span class="o">=</span> <span class="n">RANGE_UPPER</span>
                        <span class="n">arcpy</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">CreateDomain</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="p">[</span><span class="n">NAME</span><span class="p">],</span>
                                                          <span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="p">[</span><span class="n">NAME</span><span class="p">],</span>
                                                          <span class="n">FTYPES</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="p">],</span>
                                                          <span class="n">dType</span><span class="p">)</span>

                        <span class="k">try</span><span class="p">:</span>

                            <span class="k">if</span> <span class="n">dType</span> <span class="o">==</span> <span class="n">CODED</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="p">[</span><span class="n">CODED_VALUES</span><span class="p">]:</span>
                                    <span class="n">arcpy</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">AddCodedValueToDomain</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="p">[</span><span class="n">NAME</span><span class="p">],</span> <span class="n">cv</span><span class="p">[</span><span class="n">CODE</span><span class="p">],</span> <span class="n">cv</span><span class="p">[</span><span class="n">NAME</span><span class="p">])</span>

                            <span class="k">elif</span> <span class="n">dType</span> <span class="o">==</span> <span class="n">RANGE_UPPER</span><span class="p">:</span>
                                <span class="n">_min</span><span class="p">,</span> <span class="n">_max</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="p">[</span><span class="n">RANGE</span><span class="p">]</span>
                                <span class="n">arcpy</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">SetValueForRangeDomain</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="p">[</span><span class="n">NAME</span><span class="p">],</span> <span class="n">_min</span><span class="p">,</span> <span class="n">_max</span><span class="p">)</span>

                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

                        <span class="n">gdb_domains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="p">[</span><span class="n">NAME</span><span class="p">])</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added domain &quot;</span><span class="si">{}</span><span class="s1">&quot; to database: &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="p">[</span><span class="n">NAME</span><span class="p">],</span> <span class="n">ws</span><span class="p">))</span>

            <span class="c1"># add domains</span>
            <span class="n">field_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">ListFields</span><span class="p">(</span><span class="n">out_fc</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">fld</span><span class="p">,</span> <span class="n">dom_name</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dom_map</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">fld</span> <span class="ow">in</span> <span class="n">field_list</span><span class="p">:</span>
                    <span class="n">arcpy</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">AssignDomainToField</span><span class="p">(</span><span class="n">out_fc</span><span class="p">,</span> <span class="n">fld</span><span class="p">,</span> <span class="n">dom_name</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Assigned domain &quot;</span><span class="si">{}</span><span class="s1">&quot; to field &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dom_name</span><span class="p">,</span> <span class="n">fld</span><span class="p">))</span></div>

<div class="viewcode-block" id="append_feature_set"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.append_feature_set">[docs]</a><span class="k">def</span> <span class="nf">append_feature_set</span><span class="p">(</span><span class="n">out_fc</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Appends features from a feature set to existing feature class manually with an insert cursor.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        out_fc: Output feature class path.</span>
<span class="sd">        feature_set: Input feature set.</span>
<span class="sd">        cursor: Insert cursor.</span>
<span class="sd">    &quot;&quot;&quot;</span> 

    <span class="n">fc_fields</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">ListFields</span><span class="p">(</span><span class="n">out_fc</span><span class="p">)</span>
    <span class="n">cur_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fc_fields</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;OID&#39;</span><span class="p">,</span> <span class="s1">&#39;Geometry&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">)]</span>
    <span class="c1"># insert cursor to write rows manually</span>
    <span class="k">with</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">InsertCursor</span><span class="p">(</span><span class="n">out_fc</span><span class="p">,</span> <span class="n">cur_fields</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;SHAPE@&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="n">irows</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cursor</span><span class="p">(</span><span class="n">feature_set</span><span class="p">,</span> <span class="n">cur_fields</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;SHAPE@&#39;</span><span class="p">])):</span>
            <span class="n">irows</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></div>

<div class="viewcode-block" id="export_attachments"><a class="viewcode-back" href="../../../restapi/#restapi.arc_restapi.export_attachments">[docs]</a><span class="k">def</span> <span class="nf">export_attachments</span><span class="p">(</span><span class="n">out_fc</span><span class="p">,</span> <span class="n">layer</span><span class="p">):</span>
    <span class="c1"># not sure if I should support this...</span>
    <span class="k">pass</span></div>
<span class="c1">##    fc_ws, fc_ws_type = find_ws_type(out_fc)</span>
<span class="c1">##</span>
<span class="c1">##    if all([include_attachments, self.hasAttachments, fs.OIDFieldName, fc_ws_type != &#39;FileSystem&#39;]):</span>
<span class="c1">##</span>
<span class="c1">##        # get attachments (OID will start at 1)</span>
<span class="c1">##        att_folder = os.path.join(arcpy.env.scratchFolder, &#39;{}_Attachments&#39;.format(os.path.basename(out_fc)))</span>
<span class="c1">##        if not os.path.exists(att_folder):</span>
<span class="c1">##            os.makedirs(att_folder)</span>
<span class="c1">##</span>
<span class="c1">##        att_dict, att_ids = {}, []</span>
<span class="c1">##        for i,row in enumerate(fs):</span>
<span class="c1">##            att_id = &#39;P-{}&#39;.format(i + 1)</span>
<span class="c1">##            print(&#39;\nattId: {}, oid: {}&#39;.format(att_id, row.get(fs.OIDFieldName)))</span>
<span class="c1">##            att_ids.append(att_id)</span>
<span class="c1">##            att_dict[att_id] = []</span>
<span class="c1">##            for att in self.attachments(row.get(fs.OIDFieldName)):</span>
<span class="c1">##                print(&#39;\tatt: &#39;, att)</span>
<span class="c1">##                out_att = att.download(att_folder, verbose=False)</span>
<span class="c1">##                att_dict[att_id].append(os.path.join(out_att))</span>
<span class="c1">##</span>
<span class="c1">##        # photo field (hopefully this is a unique field name...)</span>
<span class="c1">##        print(&#39;att_dict is: &#39;, att_dict)</span>
<span class="c1">##</span>
<span class="c1">##        PHOTO_ID = &#39;PHOTO_ID_X_Y_Z__&#39;</span>
<span class="c1">##        arcpy.management.AddField(out_fc, PHOTO_ID, &#39;TEXT&#39;, field_length=255)</span>
<span class="c1">##        with arcpy.da.UpdateCursor(out_fc, PHOTO_ID) as rows:</span>
<span class="c1">##            for i,row in enumerate(rows):</span>
<span class="c1">##                rows.updateRow((att_ids[i],))</span>
<span class="c1">##</span>
<span class="c1">##        # create temp table</span>
<span class="c1">##        arcpy.management.EnableAttachments(out_fc)</span>
<span class="c1">##        tmp_tab = r&#39;in_memory\temp_photo_points&#39;</span>
<span class="c1">##        arcpy.management.CreateTable(*os.path.split(tmp_tab))</span>
<span class="c1">##        arcpy.management.AddField(tmp_tab, PHOTO_ID, &#39;TEXT&#39;)</span>
<span class="c1">##        arcpy.management.AddField(tmp_tab, &#39;PATH&#39;, &#39;TEXT&#39;, field_length=255)</span>
<span class="c1">##        arcpy.management.AddField(tmp_tab, &#39;PHOTO_NAME&#39;, &#39;TEXT&#39;, field_length=255)</span>
<span class="c1">##</span>
<span class="c1">##        with arcpy.da.InsertCursor(tmp_tab, [PHOTO_ID, &#39;PATH&#39;, &#39;PHOTO_NAME&#39;]) as irows:</span>
<span class="c1">##            for k, att_list in six.iteritems(att_dict):</span>
<span class="c1">##                for v in att_list:</span>
<span class="c1">##                    irows.insertRow((k,) + os.path.split(v))</span>
<span class="c1">##</span>
<span class="c1">##         # add attachments</span>
<span class="c1">##        arcpy.management.AddAttachments(out_fc, PHOTO_ID, tmp_tab, PHOTO_ID,</span>
<span class="c1">##                                        &#39;PHOTO_NAME&#39;, in_working_folder=att_folder)</span>
<span class="c1">##        arcpy.management.Delete(tmp_tab)</span>
<span class="c1">##        arcpy.management.DeleteField(out_fc, PHOTO_ID)</span>
<span class="c1">##        try:</span>
<span class="c1">##            shutil.rmtree(att_folder)</span>
<span class="c1">##        except:</span>
<span class="c1">##            pass</span>
<span class="c1">##</span>
<span class="c1">##        print(&#39;added attachments to: &quot;{}&quot;&#39;.format(out_fc))</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../">restapi</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../">Documentation overview</a><ul>
  <li><a href="../../">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Caleb Mackey.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>